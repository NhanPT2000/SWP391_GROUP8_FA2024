@model IEnumerable<DataObject.Order>
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Link Font-Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <!-- Link Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="~/css/Cart.css">
    <title>Cart</title>
</head>

<body>
    <header class="header">

        <section class="flex">

            <a href="#" class="logo"> <i class="fas fa-paw"></i> shop </a>

            <nav class="navbar">
                <a asp-action="Index" asp-controller="Home">home</a>
                <a asp-action="Index" asp-controller="Home">about</a>
                <a asp-action="Main" asp-controller="Products">shop</a>
                <a asp-action="Main" asp-controller="Services">services</a>
                <a href="#contact">contact</a>
            </nav>

            <div class="icons">
                <div class="fas fa-bars" id="menu-btn"></div>
                <a href="#" class="fas fa-shopping-cart"></a>
                <div class="fas fa-user" id="login-btn"></div>
            </div>

            @await Html.PartialAsync("User.cshtml", ViewData["User"] as DataObject.User);

        </section>

    </header>

    <main class="main-content mt-5 d-flex align-items-start justify-content-center gap-5 ">
        @foreach (var order in Model) {
            <div class="">
                <div class="wrapper-cart-detail">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>SubTotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (order.OrderDetails != null)
                            {
                                foreach (var orderdetails in order.OrderDetails)
                                {
                                    <tr data-product-id="@orderdetails.ProductId" data-price="@orderdetails.UnitPrice">
                                        <td>
                                            <img src="@Url.Action("GetImage", "User", new { fileName = orderdetails.Product.Image })" alt="Product Image">
                                            <span>@orderdetails.Product.ProductName</span>
                                        </td>
                                        <td>
                                            <span class="product-price">@orderdetails.UnitPrice</span> vnd
                                        </td>
                                        <td>
                                            <span class="btn btn-add">+</span>
                                            <input type="number" class="input-quantity" value="@orderdetails.Quantity" min="1" 
                                            max="@orderdetails.Product.UnitsInStock">
                                            <span class="btn btn-remove">-</span>
                                        </td>
                                        <td class="subtotal">@orderdetails.UnitPrice * @orderdetails.Quantity vnd</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="bill">
                <div class="wrapper-cart-total">
                <div class="wrapper-heading">
                    <h3>Cart Total</h3>
                </div>
                <div class="detail-total">
                    <span>Total</span>
                    <span>$200</span>
                </div>
                <!-- List discount is here -->
                <div class="discount-part">
                    <select class="form-select" aria-label="Default select example">
                        <option selected>Discount</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>
                </div>
                <!-- Shipping Total here -->
                <div class="shipping-part">
                    <div>
                        <p>Shipping</p>
                        <span>Flat rate <strong>$8.00</strong></span>
                        <span>Shipping to: <strong>VietNam</strong></span>
                    </div>
                    <a>Change address</a>
                </div>

                <!-- Checkout now -->
                <div class="checkour-part">
                    <div class="detail-subtotal">
                        <span>SubTotal</span>
                        <span>$208</span>
                    </div>
                    <button>Check Out</button>
                </div>

            </div>
        </div>
        }

    </main>
</body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Function to calculate the total
        function calculateTotal() {
            let total = 0;
            let shippingCost = 8;
            let subtotal = 0;

            $('.table tbody tr').each(function () {
                const price = parseFloat($(this).data('price'));
                const quantity = parseInt($(this).find('.input-quantity').val());
                const productTotal = price * quantity;
                subtotal += productTotal;
                $(this).find('.subtotal').text(productTotal + ' vnd');
            });

            total = subtotal + shippingCost;
            $('.detail-total span').text(total + ' vnd');
            $('.detail-subtotal span').text(subtotal + ' vnd');
        }
        $('.btn-add').click(function () {
            const quantityInput = $(this).siblings('.input-quantity');
            let quantity = parseInt(quantityInput.val());
            quantityInput.val(quantity + 1);
            calculateTotal();
        });

        $('.btn-remove').click(function () {
            const quantityInput = $(this).siblings('.input-quantity');
            let quantity = parseInt(quantityInput.val());
            if (quantity > 1) {
                quantityInput.val(quantity - 1);
            }
            calculateTotal();
        calculateTotal();
    });
</script>
